<!DOCTYPE html>

{% if r_lang == "ja" %}
<html lang="ja">
{% else %}
<html lang="en">
{% endif %}

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>PubCaseFinder</title>
	<!--css-->
	<link rel="stylesheet" href="/static/css/pcf/bootstrap.css">
	<link rel="stylesheet" href="https://unpkg.com/destyle.css@1.0.5/destyle.css">
	<link rel="stylesheet" href="/static/css/pcf/branc.css">
	<link rel="stylesheet" href="/static/css/pcf/branc-ie7.css">
	<link rel="stylesheet" href="/static/css/pcf/branc-ie7-codes.css">
	<link rel="stylesheet" href="/static/css/pcf/branc-embedded.css">
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="stylesheet" href="/static/css/pcf/style.css">
	<link rel="stylesheet" href="/static/css/pcf/mobile.css">
	<link
		href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Noto+Sans+JP:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

	<!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
	<link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined" rel="stylesheet">
	<!-- <link rel="stylesheet" href="/static/css/animate.css"> -->
	<!-- <link rel="stylesheet" href="/static/css/icomoon.css"> --> 

	<link rel="stylesheet" href="/static/css/pcf/magnific-popup.css">
	<link rel="stylesheet" href="/static/css/pcf/token-input-facebook.css">
	<link rel="stylesheet" href="/static/css/pcf/popup-hierarchy-hpo.css">
	<link rel="stylesheet" href="/static/css/pcf/popup-hierarchy-gene.css">

	<link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css" />
	<link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale-extreme.css" />
	
	<link rel="icon" href="/static/images/favicon.ico">

	<!-- favicon for mobile -->
    <!--link rel="apple-touch-icon" sizes="180x180" href="/static/images/apple-touch-icon.png"-->
    <!--favicon start-->
    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/pcf/top/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/pcf/top/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/pcf/top/favicon-16x16.png">
    <link rel="manifest" href="/static/images/pcf/top/site.webmanifest">
    <link rel="mask-icon" href="/static/images/pcf/top/safari-pinned-tab.svg" color="#2a3356">
    <meta name="msapplication-TileColor" content="#2a3356">
    <meta name="theme-color" content="#ffffff">
    <!--favicon end-->

	<!--schema.rog-->
	<script type="application/ld+json">
	  {
		"@context": "http://schema.org/",
		"@type": "Dataset",
		"name": "PubCaseFinder",
		"description": "PubCaseFinder (PCF) is a rare and genetic disease search system, always up-to-date",
		"url": "https://pubcasefinder.dbcls.jp/",
		"version": "1.0",
		"keywords": "PubCaseFinder,PCF,Rare Disease,Phenotype,Gene,Match,Assist",
		"creator": "Database Center for Life Science, DBCLS",
		"license": "http://creativecommons.org/licenses/by/2.1/jp/",
		"distribution": {
			"contentUrl": "http://togodb.org/db/disease_phenotype_associations_20170720",
			"fileFormat": "csv"
		}
	  }
	</script>
</head>

<body>
	<div id="fh5co-loader"></div>
	<header class="search-header">
		<div class="wrapper search-header_wrapper">
			<div class="search-header_top">
				<div class="brand">
					<a href="/" class="brand"><img src="/static/images/pcf/logo_color.svg" alt=""></a>
				</div>
				<div class="search-header_left">
					<span><a id="link_en" href="/result?target={{ r_target }}&phenotype={{ r_phenotype }}&filter={{ r_filter }}&size={{ r_size }}&display_format={{ r_display_format }}&lang=en">EN</a> / <a id="link_ja" href="/result?target={{ r_target }}&phenotype={{ r_phenotype }}&filter={{ r_filter }}&size={{ r_size }}&display_format={{ r_display_format }}&lang=ja">JA</a>
					</span>
					<button id="btn_menu"><span class="material-icons">menu</span></button>
				</div>
			</div>
			<div class="search-box_wrapper">
				<div class="search-box_form d-flex flex-nowrap">
					<div class="d-flex flex-column" style="width:52px;min-width:52px;height:100%;">
                        <div style="width:100%;height:33%;">
                            <button id="hpo-list-input-button"  class="text-button" data-toggle="modal" data-target="#hpo-list-input-modal">
                                <img  data-toggle="tooltip"
                                      data-placement="top"
                                      {% if r_lang == "ja" %}
                                      title="HPO IDのリストを入力"
                                      {% else %}
                                      title="Input HPO ID list"
                                      {% endif %}
                                    src="/static/images/pcf/HPOID.svg"></img>
                            </button>
                        </div>
						<div style="width:100%;height:33%;">
							{% if r_lang == "ja" %}
							<button id="/ehr"
							{% else %}
							<button id="https://doc2hpo.wglab.org/"
							{% endif %}
							   onclick="goDoc(this);"
							   class="text-button">
							  <img  src="/static/images/pcf/text_black.svg"
									data-toggle="tooltip"
									data-placement="top"
									{% if r_lang == "ja" %}
									title="文章から症状を自動抽出">
									{% else %}
									title="Input Free-Text (doc2hpo)">
									{% endif %}	
							  </img>
							</button>
						</div>
						<div style="width:100%;height:33%;">
							<button id="phenotouch" class="text-button">
							  <img src="/static/images/pcf/3d_black.svg"
							    data-toggle="tooltip"
							    data-placement="top"
							    {% if r_lang == "ja" %}
							    title="ヒト3Dモデルを利用して症状を検索">
							    {% else %}
							    title="Find Phenotypes using Human 3D Model">
							    {% endif %}
							  </img>
							</button>
						</div>
					</div>
					<div class="flex-grow-1 tokeninput_hpo_wrapper">
						<textarea rows="1" id="tokeninput_hpo" name="str_phenotypes"></textarea>
					</div>
					<div class="d-flex flex-column">
						<div class="" style="height:50%;"><button id="tokeninput_hpo_clear" class="round-button material-icons">clear</button></div>
						<div class="" style="height:50%;">
							<button id="search_button" style="color:white;background-color:#f8516d;opacity=1.0;border:0;" class="round-button material-icons">search</button>
						</div>
					</div>
				</div>
				<div class="search-button" id="div_search_button">
					<!-- advanced button -->
					<button id="btn_search_advanced" data-toggle="collapse" data-target="#search-box-advanced" aria-expanded="false" aria-controls="search-box-advanced">
						Filter<i class="material-icons">expand_more</i>
					</button>

					<!-- download button -->
					<button id="btn_search_download">
						<span class="material-icons">save_alt</span>
					</button>

					<!-- share button -->
					{% if r_lang == "ja" %}
					<button id="btn_search_share" data-toggle="tooltip" data-placement="top" title="共有">
					{% else %}
					<button id="btn_search_share" data-toggle="tooltip" data-placement="top" title="Share">
					{% endif %}
						<span class="material-icons">share</span>
					</button>

					<!-- display button -->
					<button id="btn_search_display">
						Display options<i class="material-icons">expand_more</i>
					</button>
				</div>
			</div>

			<div class="search-advanced collapse" id="search-box-advanced">
				<div class="search-box-advanced_wrapper">
					<div style="width:100%;margin-bottom:5px;">
						{% if r_lang == "ja" %}
						<b>結果を絞り込む</b>&nbsp;&nbsp;&nbsp;<font style="color:#C7DAAA;">|</font>&nbsp;&nbsp;&nbsp;Examples:
						<a class="filter-sample" href="/result?target=omim&phenotype=HP:0000347_ja,HP:0003022_ja,HP:0009381_ja,HP:0000204_ja,HP:0000625_ja&filter=MONDO:0007179&size=10&display_format=full&lang=ja">Example1</a>
						<a class="filter-sample" href="/result?target=omim&phenotype=HP:0001903_ja,HP:0000952_ja,HP:0001744_ja,HP:0004444_ja&filter=GENEID:2038,GENEID:6708,GENEID:6521,GENEID:286,GENEID:6710,AND_HP:0000006&size=10&display_format=full&lang=ja">Example2</a>
						<a class="filter-sample" href="/result?target=omim&phenotype=HP:0000347_ja,HP:0003022_ja,HP:0009381_ja,HP:0000204_ja,HP:0000625_ja&filter=HP:0000007,AND_MONDO:0019056,NOT_MONDO:0020124&size=10&display_format=full&lang=ja">Example3</a>
						{% else %}
						<b>Filter to narrow your search results</b>&nbsp;&nbsp;&nbsp;<font style="color:#C7DAAA;">|</font>&nbsp;&nbsp;&nbsp;Examples:
						<a class="filter-sample" href="/result?target=omim&phenotype=HP:0000347,HP:0003022,HP:0009381,HP:0000204,HP:0000625&filter=MONDO:0007179&size=10&display_format=full&lang=en">Example1</a>
						<a class="filter-sample" href="/result?target=omim&phenotype=HP:0001903,HP:0000952,HP:0001744,HP:0004444&filter=GENEID:2038,GENEID:6708,GENEID:6521,GENEID:286,GENEID:6710,AND_HP:0000006&size=10&display_format=full&lang=en">Example2</a>
						<a class="filter-sample" href="/result?target=omim&phenotype=HP:0000347,HP:0003022,HP:0009381,HP:0000204,HP:0000625&filter=HP:0000007,AND_MONDO:0019056,NOT_MONDO:0020124&size=10&display_format=full&lang=en">Example3</a>
						{% endif %}
					</div>
					<textarea class="form-control" rows="1" id="tokeninput_genes" name="str_filters"></textarea>
				</div>
			</div>
		</div>
	</header>
{% if r_lang == "ja" %}
	<input type=hidden id="r_lang" value="ja" />
{% else %}
	<input type=hidden id="r_lang" value="en" />
{% endif %}
	<section class="content-wrapper">
		<div class="content-panel" id="pcf-content"></div>
		<div class='credit'></div>
	</section>

<div id="popover_html_phenotype" style="display:none;">
	<table>
		<tr><th class="popup_content_class">HPO ID	</th><td><a href="popup_content_hpo_url" target="_blank">popup_content_pcf-phenotype-id</td></tr>

{% if r_lang == "en" %}
		<tr><th class="popup_content_class">Label</th><td>popup_content_name_en</td></tr>
{% else %}
		<tr><th class="popup_content_class">Label(ja) </th><td>popup_content_name_ja</td></tr>
		<tr><th class="popup_content_class">Label(en) </th><td>popup_content_name_en</td></tr>
{% endif %}

		<tr><th class="popup_content_class">Definition</th><td>popup_content_definition</td></tr>
		<tr><th class="popup_content_class">Comment   </th><td>popup_content_comment</td></tr>
		<tr><th class="popup_content_class">Synonym   </th><td>popup_content_synonym</td></tr>
	</table>
</div>

<div id="popover_html_disease" style="display:none;">
	<table>
		<tr><th class="popup_content_class">MONDO ID  </th><td><a href="popup_content_mondo_url" target="_blank">popup_content_pcf-disease-id</td></tr>
{% if r_lang == "en" %}
		<tr><th class="popup_content_class">Label     </th><td>popup_content_name_en</td></tr>
{% else %}
		<tr><th class="popup_content_class">Label(ja) </th><td>popup_content_name_ja</td></tr>
		<tr><th class="popup_content_class">Label(en) </th><td>popup_content_name_en</td></tr>
{% endif %}
		<tr><th class="popup_content_class">Definition</th><td>popup_content_definition</td></tr>
		<tr><th class="popup_content_class">Synonym   </th><td>popup_content_synonym</td></tr>
		<tr><th class="popup_content_class">OMIM	  </th><td>popup_content_omim_list</td></tr>
		<tr><th class="popup_content_class">Orphanet  </th><td>popup_content_orpha_list</td></tr>
	</table>
</div>

<div id="popover_html_gene" style="display:none;">
	<table>
		<tr><th class="popup_content_class">NCBI Gene ID</th><td><a href="popup_content_ncbi_gene_url" target="_blank">popup_content_pcf-gene-id</a></td></tr>
		<tr><th class="popup_content_class">HGNC symbol</th><td><a href="popup_content_hgnc_gene_url" target="_blank">popup_content_hgnc_gene_symbol</a></td></tr>
		<tr><th class="popup_content_class">Synonym</th><td>popup_content_synonym</td></tr>
		<tr><th class="popup_content_class">Full name</th><td>popup_content_full_name</td></tr>
		<tr><th class="popup_content_class">Other full name</th><td>popup_content_other_full_name</td></tr>
		<tr><th class="popup_content_class">Summary</th><td>popup_content_summary</td></tr>
		<tr><th class="popup_content_class">Type of gene</th><td>popup_content_type_of_gene</td></tr>
		<tr><th class="popup_content_class">Location</th><td>popup_content_location</td></tr>
		<tr>
			<th class="popup_content_class">Link</th>
			<td>
				<a href="http://www.hgmd.cf.ac.uk/ac/gene.php?gene=popup_content_hgnc_gene_symbol" target="_blank">HGMD</a>
				<a href="https://www.ncbi.nlm.nih.gov/clinvar/?term=popup_content_hgnc_gene_symbol" target="_blank">ClinVar</a>
				<a href="https://togovar.biosciencedbc.jp/?term=popup_content_hgnc_gene_symbol" target="_blank">TogoVar</a>
				<a href="https://www.ncbi.nlm.nih.gov/CBBresearch/Lu/Demo/LitVar/#!?query=popup_content_hgnc_gene_symbol" target="_blank">LitVar</a>
				<a href="https://www.ncbi.nlm.nih.gov/research/pubtator/?view=docsum&query=popup_content_hgnc_gene_symbol" target="_blank">PubTator</a>
				<a href="http://www.dgidb.org/genes/popup_content_hgnc_gene_symbol#_interactions" target="_blank">DGIdb</a>
			</td>
		</tr>
	</table>
</div>

<div onclick="topFunction()" id="btn_back_to_top" title="Go to top">
  <img style="height:60px;width:60px;" src="/static/images/pcf/TOP.png"></img>
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="alert_dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="alertModalLabel">New message</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="message-text" class="col-form-label">Server Response:</label>
            <textarea class="form-control" id="alert_response_text" readonly></textarea>
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label">URL:</label>
            <textarea class="form-control" id="alert_url" readonly></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary"   id="btn_retry">Try again</button>
        <button type="button" class="btn btn-info"      id="btn_copy_alert_url">Copy URL to clipboard</button>
        <button type="button" class="btn btn-secondary" id="btn_alert_close" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="alert_dialog_msg">
  <div class="modal-dialog modal-dialog-centered"  role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="alert_dialog_msg_title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="alert_dialog_msg_body">Modal body text goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" tabindex="-1" id="hpo-list-input-modal" aria-labelledby="hpo-list-input-modal-title" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content p-5">
      <div class="modal-header p-0">
        <h7 class="modal-title" id="hpo-list-input-modal-title" style="font-weight:bold;font-size:1.2rem;">
		  <img src="/static/images/pcf/HPOID.svg" style="height:22px;width:22px;"></img>
		  Import Hpo Term List
		</h7>
      </div>
      <div class="modal-body p-0">
		<div class="container-fluid p-0">
		  <div class="row mx-0 py-3">
			<p>Import Human Phenotype Ontology (HPO) term IDs.<br />You can extract multiple HPO term IDs from any kind of textual input. HPO term ids must satisfy the format HP:XXXXXXX to be recognized.</p>
		  </div>
		  <div class="row mx-0">
			<div class="col-4 px-0" style="border:1px solid #ced4da;border-radius: 0.25rem;height:256px;max-height:256px;">
			  <textarea class="form-control" id="hpo-list-input-textarea" style="background-color:#f8f9fa;border:0px;height:254px;"></textarea>
			</div>
			<div class="align-self-center">
			  <div >
                <button id="hpo-list-input-submit-button" style="color:white;background-color:#222057;opacity=1.0;height:52px;width:52px;font-size:32px;border:0px;" class="round-button material-icons">chevron_right</button>
			  </div>
			</div>
			<div class="col px-0">
			  <div class="form-control p-0" style="height:256px;max-height:256px;background-color:#ced4da;">
				<table class="form-control table table-hover p-0" id="hpo-list-input-table" style="height:254px;border:0px;"></table>
			  </div>
			</div>
		  </div>
		</div>
      </div>
      <div class="modal-footer px-0 pb-0" style="border:0;">
        <button type="button" style="padding-left:40px;padding-right:40px;" class="btn btn-secondary py-1" data-dismiss="modal" id="hpo-list-input-close-button">CANCEL</button>
        <button type="button" style="padding-left:40px;padding-right:40px;" class="btn btn-primary py-1 mr-0" id="hpo-list-input-apply-button">APPLY</button>
      </div>
    </div>
  </div>
</div>

<div id="dropdown-menu_download" style="display: none;">
<form class="px-1 py-2" id="download-form">
	<label>
		{% if r_lang == "ja" %}
			<b>ダウンロード</b>
		{% else %}
			<b>Download</b>
		{% endif %}
	</label>
	<table>
		<tr style="border:0;">
			<td style="vertical-align: middle;">Target:</td>
			<td id="str_target">
			   {% if r_target == "omim" %}
			 Genetic Disease
			   {% elif r_target == "orphanet" %}
			 Rare Disease
			   {% elif r_target == "gene" %}
			 Gene
			   {% elif r_target == "case" %}
			 Case
			   {% else %}
			 Genetic Disease
			   {% endif %}
			</td>
		</tr>
		<tr style="border:0;">
			<td style="vertical-align: middle;padding-left:0;padding-right:10px;">Selection:</td>
			<td>
			  <select style="width:200px;" class="form-control custom-select" id="sel_download_option">
				 <option value="all_shown">All displayed results</option>
				 <option value="all">All results</option>
				 <option value="sel">Selection (n)</option>
			  </select>
			</td>
		</tr>
		<tr style="border:0;">
			<td style="vertical-align: middle;padding-left:0;padding-right:10px;">Format:</td>
			<td>
			  <select style="width:200px;" class="form-control custom-select" id="sel_download_format">
				 <option value="tsv">TSV</option>
				 <option value="json">JSON</option>
			  </select>
			</td>
		</tr>
	</table>
	<!-- <div class="btn-toolbar d-flex flex-row-reverse" style="margin-top:10px;"> -->
	<div class="btn-toolbar" style="margin-top:10px;">
	  <button onclick="btn_download_click(event);" class="action-button" id="btn_download" style="margin-right:0px;">Download</button>
	</div>
</form>
</div>

<div id="dropdown-menu_share" style="display: none;">
<form class="px-2 py-2">
<label>
	{% if r_lang == "ja" %}
	<b>共有リンク</b>
	{% else %}
	<b>Link</b>
	{% endif %}
</label>
	<table>
		<tr>
			<td style="vertical-align: middle;">
				<input style="width:340px;" type="text" id="share_link" value="https://pubcasefinder.dbcls.jp/result?target={{ r_target }}&phenotype={{ r_phenotype }}&filter={{ r_filter }}&size={{ r_size }}&display_format={{ r_display_format }}&lang={{ r_lang }}" readonly>
			</td>
  		</tr>
	</table>
	<div class="btn-toolbar" style="margin-top:10px;">
		<button class="action-button" id="btn_copy_link">Copy Link</button>
		<button class="action-button" id="btn_email_link">E-mail</button>
	</div>
</form>
</div>


<div id="dropdown-menu_display" style="display: none;">
	<form class="px-3 py-2">
		<label>
			{% if r_lang == "ja" %}
			<b>表示オプション</b>
			{% else %}
			<b>Display options</b>
			{% endif %}
		</label>
		<table>
			<tr style="border:0;">
				<td style="vertical-align: middle;padding-left:0;padding-right:10px;">Format:</td>
				<td>
					<select style="width:150px;" class="custom-select" id="str_display_format" onchange="str_display_format_onchange(this.value);">
						<option value="full" {% if r_display_format == "full" %} selected {% endif %}>Full</option>
						<option value="summary" {% if r_display_format == "summary" %} selected {% endif %}>Summary</option>
			  		</select>
				</td>
			</tr>
			<tr style="border:0;">
				<td style="vertical-align: middle; padding-right:10px;" nowrap>Per page:</td>
				<td>
					<select style="width:150px;" class="custom-select" id="str_size" onchange="str_size_onchange(this.value);">
						<option value=10  {% if r_size == "10" %} selected {% endif %}>10</option>
						<option value=20  {% if r_size == "20" %} selected {% endif %}>20</option>
						<option value=50  {% if r_size == "50" %} selected {% endif %}>50</option>
						<option value=100 {% if r_size == "100" %} selected {% endif %}>100</option>
						<option value=200 {% if r_size == "200" %} selected {% endif %}>200</option>
					</select>
				</td>
			</tr>
			<tr style="border:0;">
				<td style="vertical-align: middle; padding-right:10px;" nowrap>Header:</td>
				<td>
					<select style="width:150px;" class="custom-select" id="str_header" onchange="str_header_onchange(this.value);">
						<option value=false>Fixed</option>
						<option value=true>Auto Hide</option>
					</select>
				</td>
			</tr>
		</table>
	</form>
</div>



</body>

<script type="text/javascript" src="/static/js/pcf/jquery.min.js">

<!-- START: Common footer -->
<script type="text/javascript" src="https://pubcasefinder.dbcls.jp/static/common-header-and-footer/script/common-footer.js" id="common-footer__script"></script>
<!-- END: Common footer -->

<script type="text/javascript"
	src="https://dbcls.rois.ac.jp/DBCLS-common-header-footer/v2/script/common-header-and-footer.js"
	style="display: block" id="common-header-and-footer__script" data-width="976" data-color="mono"></script>

<script src="/static/js/pcf/jquery.easing.1.3.js"></script>
<script src="/static/js/pcf/bootstrap-4.6.0.bundle.js"></script>
<script src="https://unpkg.com/@popperjs/core@2"></script>
<script src="https://unpkg.com/tippy.js@6"></script>

<script src="/static/js/pcf/jquery.waypoints.min.js"></script>
<script src="/static/js/jquery.countTo.js"></script>
<!-- modify start for chrome 91.0.4472.123-->
<!-- <script src="/static/js/pcf/jquery.magnific-popup.min.js"></script>  -->
<script src="/static/js/pcf/jquery.magnific_popup.min.js"></script>
<!-- modify end for chrome 91.0.4472.123-->
<script src="/static/js/pcf/magnific-popup-options.js"></script>
<script src="/static/js/pcf/jquery.stellar.min.js"></script>
<script src="/static/js/pcf/rater.js"></script>
<script src="/static/js/pcf/main.js"></script>

<script src="/static/js/pcf/jquery.tokeninput.js"></script>
<script src="/static/js/pcf/jquery.tokeninput_gene.js"></script>
<script src="/static/js/d3/3.5.17/d3.min.js"></script>
<script src="/static/js/three.js-r84/build/three.min.js"></script>
<script src="/static/js/three.js-r84/examples/js/Detector.js"></script>
<script src="/static/js/three-bits/OBJLoader.js"></script>
<script src="/static/js/three-bits/three-bits.js"></script>
<script src="/static/js/three-bits/three-bits-renderer.js"></script>
<script src="/static/js/three-bits/defaults.js"></script>
<script type="text/javascript" src="/static/js/pcf/popup-hierarchy-hpo.js"></script>
<script type="text/javascript" src="/static/js/pcf/popup-hierarchy-gene.js"></script>
<script src="/static/js/button-ripple-effect.js"></script>
<script type="text/javascript" src="/static/js/pcf/pcf-content.js"></script>
<script type="text/javascript" src="/static/js/pcf/pcf_collapse_panel.js"></script>

<script>

	var pcf_show_loading = function(){
		if($('#fh5co-loader').css('display') === 'none') $("#fh5co-loader").fadeIn("normal");
		//$('.popover').popover('hide');
		tippy.hideAll();
	};

	var pcf_hide_loading = function() {
		if($('#fh5co-loader').css('display') === 'none') return;
		$("#fh5co-loader").fadeOut("slow");
	};

	var pcf_show_alert_dialog = function(jqXHR, textStatus, errorThrown, url_str, retry_data_obj){
		$('.modal-backdrop').remove();
		let $alert_dialog = $("#alert_dialog");
		$('#alertModalLabel').text("Error occured.");
		if(jqXHR.statusText){
			let msgtext = jqXHR.status + ': ' + jqXHR.statusText;
			if(jqXHR.responseText){
				msgtext += '\n' + jqXHR.responseText;
			}
			$('#alert_response_text').text(msgtext);
		}else{
			$('#alert_response_text').text(jqXHR.status + ': ' + jqXHR.responseText);
		}
		$('#alert_url').text(url_str);
		$('#btn_retry').data('RETRY_DATA', retry_data_obj);
		$("#alert_dialog").modal('show');
		if($('header').is(":hidden")) $('header').show();
	}

	var pcf_show_alert_dialog_msg = function(title,msg){
		let $alert_dialog = $("#alert_dialog_msg");
		$('#alert_dialog_msg_title').text(title);
		$('#alert_dialog_msg_body').text(msg);
		$alert_dialog.modal('show');
		$('header').show();
    }

	$('#alert_dialog').scroll(function (event) {
		event.stopPropagation();
		return false;
	});

    $('#alert_dialog_msg').scroll(function (event) {
        event.stopPropagation();            
        return false;        
    });

	function btn_download_click(e) {

		$("#pcf-content").pcf_content('download',hpo_id_list,$('#sel_download_option').val(), $('#sel_download_format').val());
	
		tippy.hideAll();
	
		e.preventDefault();
		e.stopPropagation();
		return false;
	};

	$('#btn_copy_link')
		.tooltip({'title':'URL Copied to clipboard!', 'trigger':'manual', 'placement':'bottom'})
		.on('click', function (e) {
			$(this).tooltip('show');
			let copyTarget = document.getElementById("share_link");
			copyTarget.select();
			document.execCommand("Copy");
			
			$("#pcf-content").pcf_content('send_share_url', copyTarget.value);
			
			e.preventDefault();
			e.stopPropagation();
			return false;
		})
		.on('mouseleave', function () {
			$(this).tooltip('hide');
		});

	$('#btn_copy_alert_url')
		.tooltip({'title':'URL Copied to clipboard!', 'trigger':'manual', 'placement':'bottom'})
		.on('click', function (e) {
			$(this).tooltip('show');
			let copyTarget = document.getElementById("alert_url");
			copyTarget.select();
			document.execCommand("Copy");
			e.preventDefault();
			e.stopPropagation();
			return false;
		})
		.on('mouseleave', function () {
			$(this).tooltip('hide');
		});

	$('#btn_retry').on('click', function (e) {
		$('#btn_alert_close').trigger('click');
		setTimeout(function() {
			let retry_data_obj = $('#btn_retry').data('RETRY_DATA');
			$("#pcf-content").pcf_content('retry', retry_data_obj);
		}, 100);
	});

	$('#alert_dialog').on('shown.bs.modal', function () {
		setTimeout(function() {
        	$('#alert_response_text').trigger('focus');        
		}, 10);
	});

	$('#btn_email_link').on('click', function (e) {
		let copyTarget = document.getElementById("share_link");
		copyTarget.select();
		let link_text = copyTarget.value;

		$("#pcf-content").pcf_content('send_share_url', link_text);

		let mail = 'mailto:?body=' + encodeURIComponent(link_text);
		let a = document.createElement('a');
		a.href = mail;
		a.click();
		
		e.preventDefault();
		e.stopPropagation();
		return false;
	});


	function getDocHeight() {
		var D = document;
		return Math.max(
			D.body.scrollHeight, D.documentElement.scrollHeight,
			D.body.offsetHeight, D.documentElement.offsetHeight,
			D.body.clientHeight, D.documentElement.clientHeight
		);
	}

	var iev=0;
	var ieold = (/MSIE (\d+\.\d+);/.test(navigator.userAgent));
	var trident = !!navigator.userAgent.match(/Trident\/7.0/);
	var rv=navigator.userAgent.indexOf("rv:11.0");

	if (ieold) iev=new Number(RegExp.$1);
	if (navigator.appVersion.indexOf("MSIE 10") != -1) iev=10;
	if (trident&&rv!=-1) iev=11;

	if(typeof InstallTrigger !== 'undefined' || iev == 11) {
		// Firefox or IE 11
		$(window).on('scroll', function(e){

			if($.magnificPopup.instance.contentContainer && $('.mfp-wrap')) {
				let $inlineContentBase = $.magnificPopup.instance.contentContainer.find('div.popup-hierarchy-hpo-inline-content-base');
				if($inlineContentBase && $inlineContentBase.is(":visible")) return;
			}

			let tid = e.target.getAttribute('id');
			if(tid && ( tid === 'alert_response_text' || 
				    tid === 'alert_url' ||
				    tid.startsWith('copy_content_'))) return;

			tippy.hideAll();

			if (document.body.scrollTop > 110 || document.documentElement.scrollTop > 110) {
				$('#btn_back_to_top').show();
			} else {
				$('#btn_back_to_top').hide();
			}
		});
	} else {
		$('body').on('mousewheel', function(e){

			if($.magnificPopup.instance.contentContainer && $('.mfp-wrap')) {
				let $inlineContentBase = $.magnificPopup.instance.contentContainer.find('div.popup-hierarchy-hpo-inline-content-base');
				if($inlineContentBase && $inlineContentBase.is(":visible")) return;
			}

			let tid = e.target.getAttribute('id');
                        if(tid && ( tid === 'alert_response_text' ||                   
                                    tid === 'alert_url' ||
                                    tid.startsWith('copy_content_'))) return;



			tippy.hideAll();

			if (document.body.scrollTop > 110 || 
			    document.documentElement.scrollTop > 110 ||
			    $('html').scrollTop() > 110 || 
			    $('body').scrollTop() > 110) {
				$('#btn_back_to_top').show();
			} else {
				$('#btn_back_to_top').hide();
			}   
		});
	}


	$(document).on('keydown', function(e) {
	    // ESCAPE key pressed
	    if (e.keyCode == 27) {
	        tippy.hideAll();
	    }
	});

	var lastScrollTop = 0;
	function str_header_onchange(isAutoHide){
		if(isAutoHide === 'true') {
			lastScrollTop = 0;
			if(typeof InstallTrigger !== 'undefined' || iev == 11) {
				// Firefox or IE 11
				$(window).on('scroll', window_on_scroll);
			} else {
				$('body').on('mousewheel', window_on_wheel);
			}
		}else{
			if(typeof InstallTrigger !== 'undefined' || iev == 11) {
				$(window).off('scroll', window_on_scroll);
			} else {
				$('body').off('mousewheel', window_on_wheel);
			}
		}

	}

	function window_on_scroll(e){
		if($.magnificPopup.instance.contentContainer && $('.mfp-wrap')) {
			let $inlineContentBase = $.magnificPopup.instance.contentContainer.find('div.popup-hierarchy-hpo-inline-content-base');
			if($inlineContentBase && $inlineContentBase.is(":visible")) return true;
		}

		if(e.target.getAttribute('id') === 'alert_response_text' || e.target.getAttribute('id') === 'alert_url') return;

		st = $(this).scrollTop();
		if(st < lastScrollTop) {
			//console.log('Up');
			//$('header').show();
			//$('header').fadeIn("slow");
			$('header').slideDown(500);
		}
		else if(st > lastScrollTop) {
			//console.log('Down');
			//$('header').hide();
			//$('header').fadeOut("slow");
			if($(window).scrollTop() + $(window).height() < getDocHeight()-50) {
				$('header').slideUp(500);
			}
		}
		lastScrollTop = st;

		if($(window).scrollTop() + $(window).height() >= getDocHeight()-50) {
			$('header').slideDown(500);
		}

	}

	function window_on_wheel(e){
		if($.magnificPopup.instance.contentContainer && $('.mfp-wrap')) {
			let $inlineContentBase = $.magnificPopup.instance.contentContainer.find('div.popup-hierarchy-hpo-inline-content-base');
			if($inlineContentBase && $inlineContentBase.is(":visible")) return true;
		}

		if(e.target.getAttribute('id') === 'alert_response_text' || e.target.getAttribute('id') === 'alert_url') return;

		if(e.originalEvent.wheelDelta > 0) {
			//console.log('Up');
			//$('header').show();
			//$('header').fadeIn("slow");
			$('header').slideDown(500);
		}
		else if(e.originalEvent.wheelDelta < 0) {
			//console.log('Down');
			//$('header').hide();
			//$('header').fadeOut("slow");
			if($(window).scrollTop() + $(window).height() < getDocHeight()-50) {
				$('header').slideUp(500);
			}
		}

		if($(window).scrollTop() + $(window).height() >= getDocHeight()-50) {
			$('header').slideDown(500);
		}
	}

	function topFunction() {
		if($('header').is(":visible")===false) $('header').show();
		document.body.scrollTop = 0;
		document.documentElement.scrollTop = 0;
		$('#btn_back_to_top').hide();
	}

	function goDoc(obj){
		window.open(obj.id,'_blank');
	}

	var r_display_format_val = "{{ r_display_format }}";
	function str_display_format_onchange(display_format) {
		$("#pcf-content").pcf_content('update_display_format', display_format);
		r_display_format_val = display_format;
		tippy.hideAll();
		update_download_link();
		return false;
	}

	var r_size_val = "{{ r_size }}";
	function str_size_onchange(size) {
		$("#pcf-content").pcf_content('update_size', parseInt(size));
		r_size_val = size;
		tippy.hideAll();
		update_download_link();
		return false;
	}

	$("#phenotouch").click(function (e){
		$('.selected_at_popup').removeClass('selected_at_popup');
		$('.token-input-selected-token-facebook').removeClass('token-input-selected-token-facebook');
		$.PopupRelationHPOWithWebGL();
		e.preventDefault();
		e.stopPropagation();
		return false;
	});

	function uniq_fast(a) {
		let seen = {};
		let out = [];
		let len = a.length;
		let j = 0;
		for(let i = 0; i < len; i++) {
			let item = a[i];
			if(seen[item] !== 1) {
				seen[item] = 1;
				out[j++] = item;
			}
		}
		return out;
	}

	$("#hpo-list-input-submit-button").click(function (e){
		let text = $("#hpo-list-input-textarea").val().toUpperCase().replaceAll("HP:0000118","");

		if(!text){
			alert("Please input HPO term list...");
			$("#hpo-list-input-textarea").focus();
			return false;
		}

		let r = text.match(/HP:(\d){7}/g);

		if(!r){
			alert("HPO term ids must satisfy the format HP:XXXXXXX.");
			$("#hpo-list-input-textarea").focus();
			return false;
		}
	
		let unique = uniq_fast(r);	
		text = unique.join(',');

		// load hpo term list from server.

		$("#hpo-list-input-submit-button").attr("disabled", true);

		let $tbl = $("#hpo-list-input-table");
		$tbl.find("tr").remove();

		let lang      = $("#r_lang").val();

		$("#pcf-content").pcf_content('load_phenotype_objects_by_ids',text,lang,function(hpo_obj_list){

			pcf_hide_loading();

			$('#hpo-list-input-submit-button').removeAttr("disabled");

			let counter = 0;
			hpo_obj_list.forEach(function(item){
			
				let $tr  = $('<tr>').appendTo($tbl);
				$tr.addClass('table-secondary');

				let $td1 = $('<td>').appendTo($tr);
				$td1.css({'padding-left':'1.0rem'});
				let $cbx = $('<input>', {type: 'checkbox', name: 'hpo_list', "checked":"checked"}).appendTo($td1);
				$cbx.css({'margin-bottom':'unset'}).data('HPO_ITEM', item).change(function() {
					$(this).parent().parent().toggleClass('table-secondary');
				});


				let $td2 = $('<td>').css({'color':'#4582bf'}).appendTo($tr);
				$td2.text((item.id).replace(/_ja/gi, ''));

				let $td3 = $('<td>').appendTo($tr);
				$td3.css({'width':'80%'}).text(item.name);

				counter++;
			});
			if(counter === 0){
				alert("No HPO term Found.");
			}

		});

		return false;
	});
	
	$("#hpo-list-input-apply-button").click(function (e){
		let $tbl = $("#hpo-list-input-table");
		let cnt = 0;
        $tbl.find("input[name='hpo_list']:checked").each(function(){
			cnt++;
			let hpo_item = $(this).data('HPO_ITEM');
			$("#tokeninput_hpo").tokenInput("add", hpo_item);
		});
		
		if(!cnt){
			alert("No HPO term selected.");
			return false;
		}

		$("#hpo-list-input-close-button").trigger('click');

		$("#tokeninput_hpo").tokenInput("blinkLastTokens", cnt);

		setTimeout(function() {

			let element = document.getElementById("token-input-tokeninput_hpo");
			element.scrollIntoViewIfNeeded();
			$('#token-input-tokeninput_hpo').focus();
			
        }, 10);
		return false;
	});

	var share_link_val = "https://pubcasefinder.dbcls.jp/result?target={{ r_target }}&phenotype={{ r_phenotype }}&filter={{ r_filter }}&size={{ r_size }}&display_format={{ r_display_format }}&lang={{ r_lang }}";

	function update_download_link() {
		let target    = $("#pcf-content").pcf_content('get_target');
		let phenotype = hpo_id_list;
		let filter    = $("#tokeninput_genes").tokenInput_gene("get_url_str");
		let size      = r_size_val;
		let format    = r_display_format_val;
		let lang      = $("#r_lang").val();
		
		let url_str = window.location.protocol + "//" + window.location.host + window.location.pathname +
					"?target="+target+"&phenotype="+phenotype+"&filter="+filter+"&size="+size+"&display_format="+format+"&lang="+lang;

		let url_str_en = window.location.protocol + "//" + window.location.host + window.location.pathname +
					"?target="+target+"&phenotype="+phenotype+"&filter="+filter+"&size="+size+"&display_format="+format+"&lang=en";

		let url_str_ja = window.location.protocol + "//" + window.location.host + window.location.pathname +
					"?target="+target+"&phenotype="+phenotype+"&filter="+filter+"&size="+size+"&display_format="+format+"&lang=ja";

		share_link_val = url_str;

		$('#link_en').attr('href',url_str_en);

		$('#link_ja').attr('href',url_str_ja);

	};

	var runSubmit = function(){
		// trigger search
		let form = document.createElement("form");
		form.setAttribute("method", "get");
		form.setAttribute("action", "/result");

		let target = document.createElement("input");
		target.setAttribute("type", "text");
		target.setAttribute("name", "target");
		target.setAttribute("value",$("#pcf-content").pcf_content('get_target'));
		form.appendChild(target); 

		let phenotype = document.createElement("input");
		phenotype.setAttribute("type", "text");
		phenotype.setAttribute("name", "phenotype");
		phenotype.setAttribute("value",$("#tokeninput_hpo").val());															   
		form.appendChild(phenotype);

		let filter = document.createElement("input");
		let filter_str = $("#tokeninput_genes").tokenInput_gene("get_url_str");
		filter.setAttribute("type", "text");
		filter.setAttribute("name", "filter");
		filter.setAttribute("value",filter_str);
		

		form.appendChild(filter);  

		let size = document.createElement("input");
		size.setAttribute("type", "text");
		size.setAttribute("name", "size");
		size.setAttribute("value",r_size_val);
		form.appendChild(size);

		let display_format = document.createElement("input");
		display_format.setAttribute("type", "text");
		display_format.setAttribute("name", "display_format");
		display_format.setAttribute("value",r_display_format_val);
		form.appendChild(display_format); 

		let lang = document.createElement("input");
		lang.setAttribute("type", "text");
		lang.setAttribute("name", "lang");
		lang.setAttribute("value",$("#r_lang").val());
		form.appendChild(lang);

		$(form).appendTo('body').submit();

		return false;
	};

	var resizeTimer = false;

	$(window).on('resize', function(e) {
		tippy.hideAll();
		
		$("#tokeninput_genes").tokenInput_gene("resize_input_box");

		if( !resizeTimer ) {
			$(window).trigger('resizestart');  	
		}

		clearTimeout(resizeTimer);
		resizeTimer = setTimeout(function() {
			resizeTimer = false;
			$(window).trigger('resizeend');
		}, 250);
	}).on('resizestart', function(){
	//console.log('Started resizing the window');
	}).on('resizeend', function(){
	//console.log('Done resizing the window');
		customizeLevelPos();
	});


	function modify_modal_on_show(isFullScreen){
		if(isFullScreen){
			$('.mfp-bg').css({'top':'0','opacity':'0.8'});
			$('.mfp-wrap').css({'top':'0'});
			$('header').css({'top': '24px'});
			$('.mfp-container').css({'max-height':'','overflow-x':'','overflow-y':''});
		}else{
			$('header').css({'top': '0'});
			var pos = Math.ceil($("#div_search_button").offset().top);
			$('.mfp-bg').css({'top': pos+'px','opacity':'0'});
			$('.mfp-wrap').css({'top': pos+'px'});

			//popup-hierarchy-hpo-inline-content-base
			let max_height= Math.floor(document.documentElement.clientHeight) - Math.ceil(pos);
			$('.mfp-container').css({'max-height':max_height+'px','overflow-x':'hidden','overflow-y':'scroll'});

		}
	}

	function after_init_gui(){
		$('#tokeninput_gene_clear').parent().css({'border-left':'0'});
		$('#tokeninput_gene_clear').css({'display':'none'});
	}

	function after_modal_close(){
		$('header').css({'top': '24px'});
		$('#tokeninput_gene_clear').css({'display':'block'});
		$('#tokeninput_gene_clear').parent().css({'border-left':'1px solid rgb(221,221,221)'});
	}

	function customizeLevelPos(){
		if($.magnificPopup.instance.contentContainer && $('.mfp-wrap')){
			let $inlineContentBase = $.magnificPopup.instance.contentContainer.find('div.popup-hierarchy-hpo-inline-content-base');
			if($inlineContentBase){
				let $table = $inlineContentBase.find('div.popup-hierarchy-hpo-table.popup-hierarchy-hpo-class-content-base');
				let popup_hierarchy_hpo_table_border_spacing = 10;
				let $popup_wrapper = $('.mfp-wrap');
				if($popup_wrapper && $popup_wrapper.offset()){
					if($popup_wrapper.offset().top == 0){
						//$table.css({'border-spacing': popup_hierarchy_hpo_table_border_spacing+'px','width':'100%','margin-top':'0','margin-left':'0'});
					}else{
						$('header').css({'top': 0});

						$div_search_button = $("#div_search_button");

						var pos = Math.ceil($div_search_button.offset().top);

						//var left = $div_search_button.offset().left-popup_hierarchy_hpo_table_border_spacing;
						//var width = $div_search_button.width() + (popup_hierarchy_hpo_table_border_spacing * 2);
						$('.mfp-bg').css({'top': pos+'px','opacity':'0'});
						$('.mfp-wrap').css({'top': pos+'px'});

			                        let max_height= Math.floor(document.documentElement.clientHeight) - pos;
                        			$('.mfp-container').css({'max-height':max_height+'px','overflow-x':'hidden','overflow-y':'scroll'});

						//$table.css({'width':'100%','margin-left':'0'});
					}
			   } 
			}
		}else{
			$('header').css({'top': '24px'});
		}
	}

	function set_filter_num(){

		let filter_str = $("#tokeninput_genes").tokenInput_gene("get_url_str");

		let count = filter_str.split(',').length;
		if(filter_str && count > 0){
		    $('#btn_search_advanced').html("Filter("+count+")<i class=\"material-icons\">expand_more</i>");
		}else{
		        $('#btn_search_advanced').html("Filter<i class=\"material-icons\">expand_more</i>");
		}
	};

	function addFilterSample(sample_no){
		
		if(sample_no === '1'){
			$("#tokeninput_genes").tokenInput_gene("add", {
				id: "MONDO:0007179",
				logicaloperator: "",
				{% if r_lang == "ja" %}
				name: "自己免疫疾患"
				{% else %}
				name: "autoimmune disease"
				{% endif %}
			});
		}

		onFilterChanged();

                return false;
	}

	function onFilterChanged(){
		set_filter_num();
		update_download_link();
		setTimeout(function() {
			let filter_str = $("#tokeninput_genes").tokenInput_gene("get_url_str");
			$("#pcf-content").pcf_content('update_filter', filter_str);
		}, 10);

		let lang = $("#r_lang").val();
		if(lang === 'en'){
			$("#pcf-content").pcf_content('send_share_url', $('#link_en').attr('href'));
		}else{
			$("#pcf-content").pcf_content('send_share_url', $('#link_ja').attr('href'));
		}

		return false;
	};

	var hpo_id_list = "{{ r_phenotype }}";
	var filter_id_list = "{{ r_filter }}";

	{% if r_target == "omim" %}
	var str_target_label = "Genetic Disease";
	{% elif r_target == "orphanet" %}
	var str_target_label = "Rare Disease";
	{% elif r_target == "gene" %}
	var str_target_label = "Gene";
	{% elif r_target == "case" %}
	var str_target_label = "Case";
	{% else %}
	var str_target_label = "Genetic Disease";
	{% endif %}
	
	$(document).ready(function() {
		$('#hpo-list-input-modal').on('show.bs.modal', function () {
			$("#hpo-list-input-textarea").val(""); 
			$("#hpo-list-input-table").find("tr").remove();
		});

		$('#hpo-list-input-modal').on('shown.bs.modal', function () {
			setTimeout(function() {
				$('#hpo-list-input-textarea').focus();
	        }, 10);
		});


		const template_download = document.getElementById('dropdown-menu_download');
		template_download.style.display = 'block';
		tippy('#btn_search_download', {
			arrow:         true,
			allowHTML:     true,
			appendTo:      document.body,
			animation:     'scale-extreme',
			maxWidth:      400,
			strategy:     'fixed',
			interactive:   true,
			trigger:      'click',
			theme:        'pcf-popup',
			placement:    'bottom',
			content:      template_download,
			onShown(instance) {
				$('#str_target').html(str_target_label);

				let selected_num = $("#pcf-content").pcf_content('get_selected_num');

				let options = $('#sel_download_option').find('option');
				$(options[2]).text('Selection (' + selected_num + ')');
                        },
		});

		const template_share = document.getElementById('dropdown-menu_share');
		template_share.style.display = 'block';
		tippy('#btn_search_share', {
			arrow:         true,
			allowHTML:     true,
			appendTo:      document.body,
			animation:     'scale-extreme',
			maxWidth:      500,
			strategy:     'fixed',
			interactive:   true,
			trigger:      'click',
			theme:        'pcf-popup',
			placement:    'bottom',
			content:       template_share,
			onShown(instance) {
				$('#share_link').val(share_link_val);
			},
		});

		r_size_val = $("#str_size").val();
		r_display_format_val = $("#str_display_format").val();

		const template_display = document.getElementById('dropdown-menu_display');
		template_display.style.display = 'block';
		tippy('#btn_search_display', {
			arrow:         true,
			allowHTML:     true,
			appendTo:      document.body,
			animation:     'scale-extreme',
			maxWidth:      400,
			strategy:     'fixed',
			interactive:   true,
			trigger:      'click',
			theme:        'pcf-popup',
			placement:    'bottom-end',
			content:       template_display,
		});

		
		tippy('#btn_menu', {
			arrow:         false,
			allowHTML:     true,
			appendTo:      document.body,
			strategy:     'fixed',
			interactive:   true,
			placement:    'bottom-start',
			theme:        'pcf_menu',
			content(reference){
				return	"<ul id=\"ul_menu\" class=\"sub-menu\">" +
                      "<li><a href=\"https://pubcasefinder.dbcls.jp/static/pdf/PubCaseFinder_manual_ja_v4.pdf\">Guides</a></li>" +
                      "<li><a href=\"https://pubcasefinder.dbcls.jp/api\">API</a></li>" +
                      "<li><a href=\"https://pubcasefinder.dbcls.jp/history\">History</a></li>" +
                      "<li><a href=\"https://pubcasefinder.dbcls.jp/termsofservice\">Terms</a></li>" +
                      "<li><a href=\"https://pubcasefinder.dbcls.jp/datasets\">Sources</a></li>" +
                      "<li><a href=\"https://integbio.jp/rdf/dataset/pubcasefinder\" target=\"_blank\">RDF</a></li>" +
                      "<li><a href=\"mailto:support@dbcls.rois.ac.jp,pubcasefinder@dbcls.rois.ac.jp\">Contect</a></li>"+
					"</ul>";
			},
		});
		$("#tokeninput_hpo")
			.tokenInput("/tokeninput_hpo", {theme: "facebook", second_url_str: "/pcf_get_hpo_by_text", doSubmit: runSubmit});

		$("#tokeninput_hpo")
			.popupRelationHPO( '/popup_hierarchy_hpo',
							  {'modify_modal_on_show':modify_modal_on_show,
                              {% if r_lang %}
                               'language_in':   "{{ r_lang }}",
                              {% endif %}
							   'after_modal_close':	function(){
														after_modal_close();
														setTimeout(function() {
															$('#token-input-tokeninput_hpo').focus();
														}, 50);
													}
							  });

		$("#tokeninput_hpo_clear").click(function(){
			$("#tokeninput_hpo").tokenInput("clear");
			return false;
		});
		
		$('#search_button').on('click', function(){
			runSubmit();			
		});		

		$("#tokeninput_genes").tokenInput_gene("/tokeninput_filter", {
			'theme': "facebook",
			{% if r_lang %}
			'language':   "{{ r_lang }}",
			{% endif %}
			'onFilterChanged' : onFilterChanged
		});

		$("#tokeninput_genes")
			.popupRelationGENE('/popup_hierarchy_genes',{'modify_modal_on_show': modify_modal_on_show,
								     'after_modal_close':   function(){
																after_modal_close();
																setTimeout(function() {
																	$('#token-input-tokeninput_genes').focus();
																}, 50);
									 						},
								     'after_init_gui':       after_init_gui,
						            {% if r_lang %}
						             'language_in':   "{{ r_lang }}",
						            {% endif %} 
									 'onFilterChanged':      onFilterChanged
								    });

		$("#pcf-content").pcf_content({
			{% if r_target %}
			'target':	"{{ r_target }}",
			{% endif %}
			{% if r_lang %}
			'lang':		"{{ r_lang }}",
			{% endif %}
			{% if r_size %}
			'size':		{{ r_size }},
			{% endif %}
			{% if r_display_format %}
			'format':	"{{ r_display_format }}",
			{% else %}
			'format': 	"summary",
			{% endif %}
			'onSelectTab': function(tab_label_text,target){
				if(target === 'case'){
					$('#btn_search_download').prop('disabled', true);

					{% if r_lang == "ja" %}
					$('#btn_search_download').tooltip('dispose').tooltip({title: 'Caseはダウンロードできません',trigger:'hover'});
					{% else %}
					$('#btn_search_download').tooltip('dispose').tooltip({title: 'Case is not available for download',trigger:'hover'});
					{% endif %}
				}else{
					$('#btn_search_download').prop('disabled', false);

					{% if r_lang == "ja" %}
					$('#btn_search_download').tooltip('dispose').tooltip({title: 'ダウンロード',trigger:'hover'});
					{% else %}
					$('#btn_search_download').tooltip('dispose').tooltip({title: 'Download',trigger:'hover'});
					{% endif %}
				}
			
				str_target_label = tab_label_text;
				$('#str_target').html(tab_label_text);			

				update_download_link();
			},
			'load_filter_ids': function(){
				return $("#tokeninput_genes").tokenInput_gene("get");
			}
		});

		if(!filter_id_list){
			$("#token-input-tokeninput_genes").css({'width':'600px'});
		}

		$("#pcf-content").pcf_content('load_phenotype_and_filter_objects_by_ids',hpo_id_list,filter_id_list,function(hpo_obj_list, filter_obj_list){
			let id_list = [];
			hpo_obj_list.forEach(function(item){
				$("#tokeninput_hpo").tokenInput("add", item);
				id_list.push(item.id);
			});
			hpo_id_list = id_list.join(",");

			filter_obj_list.forEach(function(item){
				if(Object.keys(item).length > 0){
					$("#tokeninput_genes").tokenInput_gene("add", item);
				}
			});
			filter_id_list = $("#tokeninput_genes").tokenInput_gene("get_url_str");

			//if(filter_obj_list && filter_obj_list.length > 0){
			if(filter_id_list){
				$('#btn_search_advanced').trigger('click');
			}

			if(hpo_id_list.length > 0){
				$("#pcf-content").pcf_content('search',{'phenotype':hpo_id_list.replace(/_ja/gi,''),'filter':filter_id_list});
			}else{
				pcf_hide_loading();
			}

			update_download_link();
			set_filter_num();
		});

		$('[data-toggle="tooltip"]').tooltip({'trigger':'hover'});
	});

</script>

</html>
